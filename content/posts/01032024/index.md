---
title: "Как настроить небезопасные запросы на обновление в Nginx"
date: 2024-03-01
description: "В цифровую эпоху, когда безопасность имеет первостепенное значение, это руководство покажет, как настроить Upgrade Insecure Requests в Upgrade Insecure Requests. Эта критическая функция безопасности в веб-разработке заставляет браузеры автоматически обновлять HTTP-запросы до HTTPS. Это помогает гарантировать, что все коммуникации между клиентом и сервером зашифрованы, что повышает общую безопасность вашего веб-сайта. Настройка этой функции в NGINX помогает поддерживать безопасный просмотр для ваших пользователей и может способствовать улучшению рейтинга SEO."
tags: ["NGINX", "Linux", "SEO"]
type: post
weight: 20
showTableOfContents: true
---
В этом руководстве вы узнаете, как настроить небезопасные запросы на обновление в NGINX, гарантируя, что весь HTTP-трафик будет перенаправлен на HTTPS, что повысит безопасность вашего веб-сервера.

## Добавить обновление небезопасных запросов в Nginx глобально
### Доступ к файлу конфигурации Nginx
Инициируйте процесс, открыв файл конфигурации Nginx, который обычно находится по адресу `/etc/nginx/nginx.conf`. Используйте следующую команду, чтобы открыть файл:
```
sudo nano /etc/nginx/nginx.conf
```
Важно отметить, что для редактирования этого файла вам понадобятся права администратора. Этот шаг гарантирует, что любые изменения, которые вы делаете, безопасны и авторизованы.

### Вставить заголовок небезопасных запросов на обновление
В файле nginx.conf найдите httpблок. Здесь необходимо добавить специальную строку, которая приказывает браузерам обновить все HTTP-запросы до HTTPS. Это улучшение имеет решающее значение для обеспечения безопасности передачи данных вашего веб-сайта. Вставьте следующую строку:
```
add_header Content-Security-Policy "upgrade-insecure-requests";
```
**Пример конфигурации:**
```
http {
    ...
    add_header Content-Security-Policy "upgrade-insecure-requests";
    ...
}
```
### Тестирование обновлений Небезопасные запросы активны
Эта директива играет важную роль в обеспечении безопасности веб-сайта, гарантируя, что все запросы автоматически переводятся на защищенное соединение HTTPS, тем самым защищая данные пользователей и повышая надежность.

### Проверьте активацию небезопасных запросов на обновление
После внедрения изменений перезапустите Nginx, чтобы применить их. Используйте эту команду:
```
sudo systemctl restart nginx
```
Чтобы подтвердить активацию заголовка, выполните тест с помощью таких инструментов, как curl. Этот инструмент поможет вам проверить заголовки ответа вашего веб-сайта. Выполните следующую команду:
```
curl -I http://yourwebsite.com
```
Найдите `Content-Security-Policy: upgrade-insecure-requestsстроку` в ответе. Ее наличие подтверждает, что обновление до небезопасных запросов успешно активировано.

**Ожидаемый вывод терминала:**
```
HTTP/1.1 200 OK
Server: nginx/1.18.0 (Ubuntu)
Date: Wed, 20 Dec 2023 12:00:00 GMT
Content-Type: text/html; charset=UTF-8
Connection: keep-alive
Content-Security-Policy: upgrade-insecure-requests
...
```
## Добавить небезопасные запросы на обновление в блок сервера Nginx
### Шаг 1: Доступ к конфигурации блока сервера Nginx
Начните с доступа к определенному блоку сервера для вашего домена. Обычно он находится в `/etc/nginx/sites-available/yourdomain`. Чтобы отредактировать этот файл, используйте следующую команду, чтобы убедиться, что у вас есть необходимые административные привилегии:
```
sudo nano /etc/nginx/sites-available/yourdomain
```
Этот шаг имеет решающее значение для внесения прямых изменений в конфигурацию Nginx, специфичных для конкретного домена.

### Настройка небезопасного обновления в заголовке запросов Nginx
В конфигурации блока сервера Nginx сосредоточьтесь на повышении безопасности, добавив `upgrade-insecure-requestsдирективу`. Она должна быть размещена внутри location /блока. Эта директива предписывает браузерам переключать все HTTP-запросы на более безопасный HTTPS, повышая безопасность данных вашего веб-сайта.

**Добавьте следующую конфигурацию:**
```
server {
    ...
    location / {
        add_header Content-Security-Policy "upgrade-insecure-requests";
    }
    ...
}
```
Этот параметр играет важную роль в защите отдельных блоков сервера, особенно если на одном сервере Nginx размещено несколько доменов или поддоменов.

### Проверьте функциональность небезопасных запросов на обновление
После сохранения изменений перезапустите Nginx, чтобы новые настройки вступили в силу:
```
sudo systemctl restart nginx
```
Чтобы убедиться, что заголовок активен, используйте такой инструмент, как `curl` проверка заголовков HTTP-ответа:
```
curl -I http://yourdomain.com
```
Как и в предыдущем разделе, найдите `Content-Security-Policy: upgrade-insecure-requests` в ответе. Это подтверждает, что заголовок правильно реализован и активен для вашего конкретного блока сервера.

## Безопасные запросы на обновление Nginx: расширенные примеры
### Условное обновление на основе метода запроса
Эта настройка идеально подходит для сценариев, где вам нужно дифференцировать поведение на основе метода HTTP-запроса. Она выборочно применяет заголовок `upgrade-insecure-requests`, избегая его для чувствительных POST-запросов, которые могут привести к проблемам с отправкой данных.
```
map $request_method $upgrade_insecure {
    POST   0;
    default 1;
}

server {
    ...
    location / {
        if ($upgrade_insecure) {
            add_header Content-Security-Policy "upgrade-insecure-requests";
        }
        ...
    }
}
```
### Обновления, специфичные для User-Agent
Настройка процесса обновления на основе браузера пользователя может быть существенной для совместимости. Эта конфигурация активирует обновление только для определенных пользовательских агентов, таких как Chrome или Firefox, обеспечивая более целенаправленный подход.
```
map $http_user_agent $upgrade_condition {
    ~*chrome 1;
    ~*firefox 1;
    default 0;
}

server {
    ...
    location / {
        if ($upgrade_condition) {
            add_header Content-Security-Policy "upgrade-insecure-requests";
        }
        ...
    }
}
```
### Заявка на обновление по конкретному пути
Применение обновлений безопасности к определенным областям сайта может иметь решающее значение, особенно в средах, где только определенные разделы обрабатывают конфиденциальную информацию. Эта настройка позволяет выполнить обновление для указанного пути, например `/secure-area/`.
```
server {
    ...
    location /secure-area/ {
        add_header Content-Security-Policy "upgrade-insecure-requests";
        ...
    }
    location / {
        ...
    }
}
```

### Интеграция обновления с дополнительными заголовками безопасности
Объединение директивы upgrade-insecure-requests с другими заголовками безопасности повышает общую безопасность сервера. Этот комплексный подход идеально подходит для сред, требующих надежных мер безопасности.

```
server {
    ...
    location / {
        add_header Content-Security-Policy "upgrade-insecure-requests; default-src https:";
        add_header X-Content-Type-Options nosniff;
        add_header X-Frame-Options SAMEORIGIN;
        ...
    }
}
```
### Реализация обновления с помощью пользовательского ведения журнала
Эта конфигурация помогает отслеживать процесс обновления в средах, где мониторинг и ведение журнала имеют важное значение. Она регистрирует запросы, обновленные с HTTP на HTTPS, помогая в аудите и анализе безопасности.
```
map $scheme $log_upgrade {
    http 1;
    default 0;
}

server {
    ...
    location / {
        if ($log_upgrade) {
            access_log /var/log/nginx/upgrade.log;
            add_header Content-Security-Policy "upgrade-insecure-requests";
        }
        ...
    }
}
```
Эти расширенные конфигурации обеспечивают детальный контроль над тем, как и когда происходит обновление с HTTP на HTTPS, удовлетворяя конкретные потребности и повышая безопасность и функциональность серверов Nginx.

## Заключение
Настроив Upgrade Insecure Requests в NGINX, вы гарантируете, что весь HTTP-трафик будет автоматически обновлен до HTTPS, что повышает безопасность вашего сайта. Эта конфигурация не только защищает пользовательские данные, но и помогает улучшить SEO вашего сайта. Регулярно просматривайте и обновляйте настройки NGINX, чтобы поддерживать оптимальную безопасность и производительность. Наслаждайтесь спокойствием, которое приходит, когда вы знаете, что ваш веб-трафик защищен и зашифрован.