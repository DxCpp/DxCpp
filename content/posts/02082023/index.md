---
title: "Как создать правила перезаписи в Nginx"
date: 2023-08-02
description: "Правила перезаписи NGINX предоставляют мощный способ изменения и управления запросами URL на вашем веб-сервере. Эти правила необходимы для перенаправления URL, изменения структур URL и улучшения SEO. Используя правила перезаписи, вы можете гарантировать, что пользователи и поисковые системы смогут эффективно получать доступ к вашему контенту и поддерживать чистую и организованную структуру URL. Освоение правил перезаписи позволяет вам улучшить функциональность и гибкость вашего веб-сервера, обеспечивая лучший общий пользовательский опыт."
tags: ["NGINX", "Linux"]
type: post
weight: 20
showTableOfContents: true
---
В этом руководстве объясняется, как создавать правила перезаписи в NGINX, а также приводятся понятные примеры и шаги, которые помогут вам настроить сервер для эффективной обработки изменений URL-адресов.

## Правила перезаписи NGINX: Директива возврата
Директива NGINX return — это мощный инструмент для управления ответами сервера. Она в основном используется для перенаправления клиентов на разные URL-адреса или для отправки определенных кодов статуса. Эта директива упрощает перенаправление трафика, особенно при перемещении или реструктуризации вашего веб-сайта. Она необходима для SEO и поддержания пользовательского опыта во время переходов. Давайте рассмотрим уникальный пример, чтобы понять ее применение:

Пример: Предположим, вы хотите перенаправить пользователей со старой страницы на новую. В вашем файле конфигурации NGINX вы можете использовать директиву returnследующим образом:
```
server {
    listen 80;
    server_name oldsite.com;
    return 301 http://newsite.com$request_uri;
}
```
В этом примере любой запрос к oldsite.com постоянно перенаправляется на newsite.com, сохраняя URI запроса. Код статуса 301 указывает на постоянное перенаправление, информируя поисковые системы о необходимости обновить индексацию.

## Правила перезаписи NGINX: Директива перезаписи
Директива NGINX rewrite используется для изменения URI запроса различными способами перед дальнейшей обработкой. Она более универсальна, чем директива return, позволяя выполнять сложные манипуляции URL на основе условий. Эта функция имеет решающее значение для создания дружественных к SEO URL и управления устаревшими ссылками.

**Пример:** Представьте, что вам нужно преобразовать динамический URL в статический для лучшего SEO. Вы можете использовать директиву перезаписи следующим образом:
```
server {
    listen 80;
    server_name example.com;
    location /products {
        rewrite ^/products/([0-9]+)/([0-9]+)$ /product?id=$1&page=$2 last;
    }
}
```
В этом сценарии URL-адрес типа example.com/products/123/2 внутренне переписывается на `example.com/product?id=123&page=2`. Последний флаг указывает, что процесс перезаписи следует остановить, а новый URI следует переоценить.

## Пример правил перезаписи NGINX
### Реализация правил перезаписи HTTPS в NGINX
Обеспечение безопасных соединений через HTTPS имеет решающее значение для безопасности данных. Директива NGINX rewrite может перенаправить весь трафик HTTP на HTTPS, повышая безопасность данных при передаче.
```
server {
    listen 80;
    server_name example.com;
    return 301 https://$host$request_uri;
}
```
В этом примере HTTP-запросы к example.com перенаправляются на HTTPS, обеспечивая зашифрованную связь.

### Оптимизация URL-адресов: удаление дубликатов слешей в правилах перезаписи NGINX
Иногда URL-адреса могут содержать дублирующиеся слеши, что приводит к путанице или ошибкам. Директива rewrite NGINX эффективно справляется с этим, преобразуя URL-адреса с двойными слешами в одинарный слеш.
```
server {
    server_name example.com;
    if ($request_uri ~* "\/\/") {
        rewrite ^/(.*)/$ /$1 permanent;
    }
}
```
Это правило оптимизирует URL-адреса, удаляя лишние слеши.

### Перенаправление каталогов: правила перезаписи NGINX в действии
При реорганизации или перемещении ресурсов часто необходимо эффективно перенаправлять целые каталоги. NGINX облегчает это с помощью своего правила перезаписи.
```
location ^~ /old-directory/ {
    rewrite ^/old-directory/(.*)$ /new-directory/$1 permanent;
}
```
Эта команда перенаправляет все запросы из `/old-directory/` в `/new-directory/`.

### Манипуляции со строками запросов с использованием правил перезаписи в NGINX
Изменение URL-адресов на основе строк запроса может быть особенно полезным во время редизайна сайта. Правила перезаписи NGINX позволяют выполнять динамическую реструктуризацию URL-адресов на основе этих параметров.
```
if ($args ~ "^id=(.*)&lang=(.*)") {
    set $id $1;
    set $lang $2;
    rewrite ^/page.php$ /page/$lang/$id? permanent;
}
```
Здесь правило перезаписи преобразует сложные строки запроса в более оптимизированные URL-адреса.

### Обеспечение единообразия URL-адресов: завершающий слеш в правилах перезаписи NGINX
Единообразие структуры URL-адресов, например, завершающий слеш, может иметь решающее значение для согласованности сайта и SEO.
```
rewrite ^([^.]*[^/])$ $1/ permanent;
```
Это правило гарантирует, что все URL-адреса заканчиваются косой чертой, сохраняя стандартизированный формат.

### Перенаправление на основе методов: применение правил перезаписи в NGINX
NGINX допускает перенаправления на основе определенных методов запроса, таких как POST, что может иметь решающее значение для безопасной обработки отправленных форм.
```
if ($request_method = POST ) {
    return 301 https://example.com$request_uri;
}
```
Эта команда перенаправляет все запросы POST на URL-адрес HTTPS.

### Защита изображений с помощью правил перезаписи NGINX
Защитите ресурсы вашего сервера, предотвратив несанкционированный прямой доступ к вашим изображениям.
```
location ~ .(gif|png|jpe?g)$ {
    valid_referers none blocked ~.google. ~.bing. ~.yahoo. example.com *.example.com;
    if ($invalid_referer) {
        rewrite ^/images/(.*)$ /stop-hotlinking.$1 last;
    }
}
```
Эта настройка перенаправляет запросы с недействительными реферерами, эффективно блокируя хотлинкинг.

### Обеспечение использования строчных букв в URL-адресах для обеспечения единообразия
Использование строчных букв в URL-адресах на вашем сайте повышает согласованность и предотвращает путаницу.
```
location ~ [A-Z] {
    rewrite ^(.*)$ $scheme://$host$1 lowercase;
}
```
Эта команда преобразует все заглавные буквы URL-элементов в строчные.

### Обработка изменений в структуре URL
При обновлении веб-сайта решающее значение имеет адаптация к новым структурам URL-адресов без потери трафика и ухудшения пользовательского опыта.
```
server {
    listen 80;
    server_name example.com;
    
    location ~* ^/oldpath/(.*) {
        rewrite ^/oldpath/(.*)$ /newpath/$1 permanent;
    }
}
```
Перенаправляет пользователей и поисковые системы со старых URL-адресов на новые.

### Создание чистых URL-адресов для платформ CMS
Для платформ CMS, использующих строки запросов, правила перезаписи NGINX могут создавать более чистые и удобные для SEO URL-адреса.
```
location / {
    try_files $uri $uri/ @extensionless-php;
    index index.html index.htm index.php;
}

location ~ \.php$ {
    try_files $uri =404;
}

location @extensionless-php {
    rewrite ^(/[^.]*[^/])$ $1.php last;
}
```
Эта настройка преобразует URL-адреса в более читабельный формат, потенциально повышая эффективность SEO.

### Заключение
Создавая и настраивая правила перезаписи в NGINX, вы можете оптимизировать управление URL, улучшить SEO и обеспечить бесперебойный пользовательский опыт. Регулярно просматривайте и тестируйте правила перезаписи, чтобы убедиться, что они работают так, как ожидается, и вносите коррективы по мере необходимости. Освоение правил перезаписи NGINX позволяет вам использовать всю мощь NGINX для более динамичного и отзывчивого веб-сервера.